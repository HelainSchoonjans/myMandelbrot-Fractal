// Generated by CoffeeScript 1.9.1
(function() {
  var Complex, Fractal;

  Complex = (function() {
    function Complex(r1, i1) {
      this.r = r1 != null ? r1 : 0;
      this.i = i1 != null ? i1 : 0;
      this.magnitude = this.r * this.r + this.i * this.i;
    }

    Complex.prototype.plus = function(c2) {
      return new Complex(this.r + c2.r, this.i + c2.i);
    };

    Complex.prototype.times = function(c2) {
      return new Complex(this.r * c2.r - this.i * c2.i, this.r * c2.i + this.i * c2.r);
    };

    Complex.prototype.negation = function() {
      return new Complex(-1 * this.r, -1 * this.i);
    };

    Complex.prototype.inverse = function() {
      if (this.magnitude === 0) {
        throw Error("no inverse");
      }
      return new Complex(this.r / this.magnitude, -1 * this.i / this.magnitude);
    };

    Complex.prototype.toString = function() {
      if (this.i === 0) {
        return "" + this.r;
      }
      if (this.r === 0) {
        return this.i + "i";
      }
      if (this.i > 0) {
        return this.r + " + " + this.i + "i";
      } else {
        return this.r + " - " + (-1 * this.i) + "i";
      }
    };

    return Complex;

  })();

  Fractal = (function() {
    Fractal.prototype.numberOfRows = 400;

    Fractal.prototype.numberOfColumns = 600;

    Fractal.prototype.canvas = null;

    Fractal.prototype.drawingContext = null;

    Fractal.prototype.epsilon = 0.0001;

    Fractal.prototype.maxIterations = 25;

    Fractal.prototype.cellSize = 1;

    Fractal.prototype.resolution = 150;

    Fractal.prototype.type = 'circle';

    function Fractal() {
      this.createCanvas();
      this.resizeCanvas();
      this.createDrawingContext();
      this.drawFractal();
    }

    Fractal.prototype.drawFractal = function() {
      switch (this.type) {
        case 'circle':
          return this.drawCircleFractal();
        case 'mandelbrot':
          return this.drawMandelbrot();
      }
    };

    Fractal.prototype.createCanvas = function() {
      this.canvas = document.createElement('canvas');
      return document.body.appendChild(this.canvas);
    };

    Fractal.prototype.resizeCanvas = function() {
      this.canvas.height = this.cellSize * this.numberOfRows;
      return this.canvas.width = this.cellSize * this.numberOfColumns;
    };

    Fractal.prototype.createDrawingContext = function() {
      return this.drawingContext = this.canvas.getContext('2d');
    };

    Fractal.prototype.drawCircle = function(x, y, radius) {
      this.drawingContext.strokeStyle = "hsl(" + radius + ", 60%, 50%)";
      this.drawingContext.beginPath();
      this.drawingContext.arc(x, y, radius, 0, 2 * Math.PI);
      this.drawingContext.stroke();
      if (radius > 2) {
        this.drawCircle();
        this.drawCircle(x + radius / 2, y, radius / 2);
        return this.drawCircle(x - radius / 2, y, radius / 2);
      }
    };

    Fractal.prototype.drawCircleFractal = function() {
      return this.drawCircle(this.numberOfColumns / 2, this.numberOfRows / 2, 200);
    };

    Fractal.prototype.drawMandelbrot = function() {
      var column, j, k, ref, ref1, row;
      console.log("Begin generation with", this.maxIterations, "iteration(s)");
      for (row = j = 0, ref = this.numberOfRows; 0 <= ref ? j < ref : j > ref; row = 0 <= ref ? ++j : --j) {
        for (column = k = 0, ref1 = this.numberOfColumns; 0 <= ref1 ? k < ref1 : k > ref1; column = 0 <= ref1 ? ++k : --k) {
          this.drawCurrentPixel(row, column);
        }
      }
      return console.log("Finished");
    };

    Fractal.prototype.drawCurrentPixel = function(row, column) {
      var b, c, i, iteration, r, x, y, z;
      iteration = 0;
      r = (column - this.numberOfColumns / 2) / this.resolution;
      i = (row - this.numberOfRows / 2) / this.resolution;
      c = new Complex(r, i);
      z = new Complex(0, 0);
      while (iteration < this.maxIterations && z.magnitude < 2) {
        z = z.times(z).plus(c);
        iteration = iteration + 1;
      }
      b = iteration * 360 / this.maxIterations;
      this.drawingContext.fillStyle = "hsl(" + b + ", 60%, 50%)";
      x = column * this.cellSize;
      y = this.canvas.height - row * this.cellSize;
      return this.drawingContext.fillRect(x, y, this.cellSize, this.cellSize);
    };

    Fractal.prototype.applyDeltaIterations = function(delta) {
      this.maxIterations += delta;
      return this.drawMandelbrot();
    };

    return Fractal;

  })();

  window.Fractal = Fractal;

}).call(this);
